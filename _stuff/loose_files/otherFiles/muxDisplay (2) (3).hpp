/* =============================================================================
 * Project:		FunSAPE++ AVR Library
 * File name:	muxDisplay.hpp
 * Module:		Seven Segments Multiplexed Display cotroller class
 * Author(s):	__AUTHORS_MACRO_TO_BE_CHANGED__
 * Build:		__BUILD_MACRO_TO_BE_CHANGED__
 * Date:		__DATE_MACRO_TO_BE_CHANGED__
 * ========================================================================== */

// =============================================================================
// File build
// =============================================================================

#ifndef __MUX_DISPLAY_HPP
#define __MUX_DISPLAY_HPP						__BUILD_MACRO_TO_BE_CHANGED__

// =============================================================================
// System file dependencies
// =============================================================================

#include "..\funsapeAvrGlobalDefines.hpp"
#if __FUNSAPE_AVR_PROJECT_CONFIG_HPP != __BUILD_MACRO_TO_BE_CHANGED__
#	error	Project configurations file (funsapeAvrGlobalDefines) must be build __BUILD_MACRO_TO_BE_CHANGED__.
#endif
#include "sevenSegments.hpp"
#include "..\funsapeAvrGpio.hpp"

// =============================================================================
// Constants
// =============================================================================

// -----------------------------------------------------------------------------
// Undefining previous definitions
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Defining new constants
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Defining macro-functions
// -----------------------------------------------------------------------------

// NONE

// =============================================================================
// New data types
// =============================================================================

// -----------------------------------------------------------------------------
// Single variables
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Enumerations - Logic values
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Enumerations - Finite lists
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Enumerations - Expansible lists
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Enumerations - Lists that can be algebraically manipulated
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Enumerations - Lists that can be manipulated using bitwise operations
// -----------------------------------------------------------------------------

// NONE

// =============================================================================
// Global variable declaration
// =============================================================================

// NONE

// =============================================================================
// Class declaration
// =============================================================================

// -----------------------------------------------------------------------------
// Class SevenSeg - Start
// -----------------------------------------------------------------------------

class MuxDisplay
{
	// -------------------------------------------------------------------------
	// New data types
	// -------------------------------------------------------------------------
	// NONE

	// -------------------------------------------------------------------------
	// New data declaration ----------------------------------------------------
private:
	// NONE

	// -------------------------------------------------------------------------
	// New data overloading operators ------------------------------------------
private:
	// NONE

	// -------------------------------------------------------------------------
	// Constructors
	// -------------------------------------------------------------------------
public:

	MuxDisplay(uint8_t displaySize);						// Automatic constructor

	// -------------------------------------------------------------------------
	// Public methods
	// -------------------------------------------------------------------------
public:
	bool setValue(
		uint32_t counter);
	bool setValue(
		uint8_t hours,
		uint8_t minutes);
	bool setGpio(
		GpioTypeDef_e segments,
		GpioTypeDef_e control,
		uint8_t controlOffset);
	bool setGpio(
		GpioTypeDef_e segAD,
		uint8_t segAdOffset,
		GpioTypeDef_e segEP,
		uint8_t segEpOffset,
		GpioTypeDef_e control,
		uint8_t controlOffset);
	bool update(void);
	Error getLastError(void);

	// -------------------------------------------------------------------------
	// Private methods
	// -------------------------------------------------------------------------
private:
	uint8_t _getSegments(
		uint8_t value,
		bool pointStatus);

	// -------------------------------------------------------------------------
	// Protected methods
	// -------------------------------------------------------------------------
protected:

	// -------------------------------------------------------------------------
	// Private properties
	// -------------------------------------------------------------------------
private:
	////////////////////////////////    GPIO    ////////////////////////////////
	uint8_t 			_segAdOffset;
	reg_t 				*_segAdDir;
	reg_t 				*_segAdOut;
	reg_t 		 		*_segEpDir;
	reg_t 		 		*_segEpOut;
	uint8_t 			_segEpOffset;
	reg_t 		 		*_controlDir;
	reg_t 		 		*_controlOut;
	uint8_t 			_controlOffset;
	bool 				_segmetsSplited			: 1;
	///////////////////////    DISPLAY  CONFIGURATION    ///////////////////////
	displayType_t		_type					: 1;
	uint32_t			_value					: 27;
	uint8_t 			_hours;
	uint8_t 			_minutes;
	bool 				_displayAsClock			: 1;
	////////////////////////////    DISPLAY DATA    ////////////////////////////
	uint8_t				_displayIndex			: 3;
	uint8_t				_displaySize			: 3;
	uint8_t 			*_displayData;
	///////////////////////////////    STATUS    ///////////////////////////////
	bool				_initialized			: 1;
	Error				_lastError;

	// -------------------------------------------------------------------------
	// Protected properties
	// -------------------------------------------------------------------------
protected:

}; // class MuxDisplay

// -----------------------------------------------------------------------------
// Class MuxDisplay - Class overloading operators
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Class MuxDisplay - Class inline functions definitions
// -----------------------------------------------------------------------------

// NONE

// -----------------------------------------------------------------------------
// Class MuxDisplay - End
// -----------------------------------------------------------------------------

// =============================================================================
// General public functions declarations
// =============================================================================

// NONE

// =============================================================================
// General inline functions definitions
// =============================================================================

// NONE

// =============================================================================
// External default objects
// =============================================================================

// NONE

#endif // __MUX_DISPLAY_HPP
